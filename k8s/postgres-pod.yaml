# PostgreSQL Pod for Bake with Love Bakery
apiVersion: v1
kind: Pod
metadata:
  name: bakery-db
  namespace: bakery
  labels:
    app: bake-with-love
    component: database
spec:
  containers:
    - name: postgres
      image: postgres:15-alpine
      ports:
        - containerPort: 5432
          name: postgres
      env:
        - name: POSTGRES_DB
          value: "bakery_db"
        - name: POSTGRES_USER
          value: "bakery_user"
        - name: POSTGRES_PASSWORD
          value: "bakery_password"
      volumeMounts:
        - name: postgres-data
          mountPath: /var/lib/postgresql/data
      readinessProbe:
        exec:
          command:
            - pg_isready
            - -U
            - bakery_user
            - -d
            - bakery_db
        initialDelaySeconds: 10
        periodSeconds: 10
        timeoutSeconds: 5
      livenessProbe:
        exec:
          command:
            - pg_isready
            - -U
            - bakery_user
            - -d
            - bakery_db
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 5
      resources:
        requests:
          memory: "256Mi"
          cpu: "250m"
        limits:
          memory: "512Mi"
          cpu: "500m"
  volumes:
    - name: postgres-data
      emptyDir: {}
---
# PostgreSQL Service
apiVersion: v1
kind: Service
metadata:
  name: bakery-db
  namespace: bakery
  labels:
    app: bake-with-love
    component: database
spec:
  selector:
    app: bake-with-love
    component: database
  ports:
    - port: 5432
      targetPort: 5432
      name: postgres
  type: ClusterIP
