{% extends 'admin_panel/base.html' %}

{% block title %}Order #{{ order.order_number }}{% endblock %}

{% block content %}
<div class="admin-page-header">
    <div>
        <h1>Order Details</h1>
        <nav class="admin-breadcrumb">
            <a href="{% url 'admin_panel:orders' %}">Orders</a> / <span>{{ order.order_number }}</span>
        </nav>
    </div>
</div>

<div class="order-detail-grid">
    <div class="admin-card">
        <div class="card-header">
            <h3>Order Information</h3>
            <span class="status-badge status-{{ order.status }} status-large">{{ order.get_status_display }}</span>
        </div>
        <div class="card-body">
            <div class="order-meta">
                <div class="meta-item">
                    <span class="meta-label">Order Number</span>
                    <span class="meta-value">{{ order.order_number }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Date</span>
                    <span class="meta-value">{{ order.created_at|date:"F d, Y H:i" }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Total</span>
                    <span class="meta-value">₹{{ order.total }}</span>
                </div>
            </div>

            <h4>Order Items</h4>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Qty</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td>{{ item.product_name }}</td>
                        <td>₹{{ item.price }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>₹{{ item.subtotal }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3"><strong>Total</strong></td>
                        <td><strong>₹{{ order.total }}</strong></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div class="order-sidebar">
        <div class="admin-card">
            <div class="card-header">
                <h3>Update Status</h3>
            </div>
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}
                    <div class="form-group">
                        <select name="status" class="admin-select">
                            <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="confirmed" {% if order.status == 'confirmed' %}selected{% endif %}>Confirmed
                            </option>
                            <option value="preparing" {% if order.status == 'preparing' %}selected{% endif %}>Preparing
                            </option>
                            <option value="ready" {% if order.status == 'ready' %}selected{% endif %}>Ready for Pickup
                            </option>
                            <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered
                            </option>
                            <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelled
                            </option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-admin-primary btn-full">Update Status</button>
                </form>
            </div>
        </div>

        <div class="admin-card">
            <div class="card-header">
                <h3>Customer Info</h3>
            </div>
            <div class="card-body">
                <p><strong>{{ order.user.full_name }}</strong></p>
                <p>{{ order.user.email }}</p>
                <p>{{ order.phone }}</p>
                <hr>
                <p><strong>Delivery Address</strong></p>
                <p>{{ order.address }}</p>
                {% if order.notes %}
                <hr>
                <p><strong>Notes</strong></p>
                <p>{{ order.notes }}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}