{% extends 'base.html' %}
{% load static %}

{% block title %}Products{% endblock %}

{% block content %}
<section class="page-section">
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">
                {% if current_category %}
                    {{ current_category.name|title }}
                {% else %}
                    Our Products
                {% endif %}
            </h1>
            <p class="page-subtitle">
                {% if current_category and current_category.description %}
                    {{ current_category.description }}
                {% else %}
                    Explore our freshly baked delights
                {% endif %}
            </p>
        </div>

        <div class="products-page-layout">
            <!-- Filters Sidebar -->
            <aside class="filters-sidebar">
                <div class="filter-section">
                    <h3 class="filter-title">Categories</h3>
                    <ul class="filter-list">
                        <li><a href="{% url 'core:products' %}"
                                class="filter-link {% if not current_category %}active{% endif %}">All Products</a></li>
                        {% for category in categories %}
                        <li><a href="{% url 'core:products' %}?category={{ category.slug }}"
                                class="filter-link {% if current_category == category.slug %}active{% endif %}">{{
                                category.name|title }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </aside>

            <!-- Products Grid -->
            <div class="products-main">
                {% if search_query %}
                <div class="search-results-info">
                    <p>Showing results for "<strong>{{ search_query }}</strong>"</p>
                    <a href="{% url 'core:products' %}" class="clear-search">Clear search</a>
                </div>
                {% endif %}

                <div class="products-grid">
                    {% for product in products %}
                    <div class="product-card">
                        <a href="{% url 'core:product_detail' slug=product.slug %}" class="product-image-link">
                            <div class="product-image">
                                {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                                {% else %}
                                <div class="product-placeholder">🧁</div>
                                {% endif %}
                                {% if product.is_special %}
                                <span class="product-badge badge-special">Special</span>
                                {% endif %}
                                {% if not product.is_available %}
                                <span class="product-badge badge-soldout">Sold Out</span>
                                {% endif %}
                            </div>
                        </a>
                        <div class="product-info">
                            <span class="product-category">{{ product.category.name }}</span>
                            <h3 class="product-name">{{ product.name }}</h3>
                            <p class="product-price">₹{{ product.price }} {% if product.weight %}<span
                                    class="product-weight">({{ product.weight }})</span>{% endif %}</p>
                            <div class="product-rating">
                                {% for i in "12345" %}
                                {% if forloop.counter <= product.rating %} <span class="star filled">★</span>
                                    {% else %}
                                    <span class="star">☆</span>
                                    {% endif %}
                                    {% endfor %}
                            </div>
                            {% if product.is_available %}
                            <form action="{% url 'core:add_to_cart' product_id=product.id %}" method="POST"
                                class="add-to-cart-form">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-add-cart">Add to Cart</button>
                            </form>
                            {% else %}
                            <button class="btn btn-disabled" disabled>Out of Stock</button>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="no-products">
                        <span class="no-products-icon">🍞</span>
                        <h3>No products found</h3>
                        <p>Try adjusting your search or browse our categories.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}